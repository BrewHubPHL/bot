[build]
  publish = ".next"
  command = "npm run build"

[[plugins]]
  package = "@netlify/plugin-nextjs"

[functions]
  directory = "netlify/functions"
  node_bundle = {} 

[dev]
  command = "npm run dev"
  port = 8888
  targetPort = 3000
  framework = "next"

# Legacy HTML pages
[[redirects]]
  from = "/staff"
  to = "/login.html"
  status = 302
  force = true

[[redirects]]
  from = "/login.html"
  to = "/login.html"
  status = 200

[[redirects]]
  from = "/staff-hub.html"
  to = "/staff-hub.html"
  status = 200

[[redirects]]
  from = "/cafe.html"
  to = "/cafe.html"
  status = 200

[[redirects]]
  from = "/kds.html"
  to = "/kds.html"
  status = 200

[[redirects]]
  from = "/manager.html"
  to = "/manager.html"
  status = 200

[[redirects]]
  from = "/admin.html"
  to = "/admin.html"
  status = 200

[[redirects]]
  from = "/parcels.html"
  to = "/parcels.html"
  status = 200

[[redirects]]
  from = "/scan.html"
  to = "/scan.html"
  status = 200

# AI Agent API endpoints (clean URLs)
[[redirects]]
  from = "/api/menu"
  to = "/.netlify/functions/get-menu"
  status = 200
  force = true

[[redirects]]
  from = "/api/order"
  to = "/.netlify/functions/ai-order"
  status = 200
  force = true

[[redirects]]
  from = "/api/loyalty"
  to = "/.netlify/functions/get-loyalty"
  status = 200
  force = true

[[redirects]]
  from = "/api/navigate"
  to = "/.netlify/functions/navigate-site"
  status = 200
  force = true

[[edge_functions]]
  path = "/marketing-bot"
  function = "marketing-bot"

# Scheduled: Cancel orders stuck in 'pending' for >30 minutes
[functions."cancel-stale-orders"]
  schedule = "@every 5m"